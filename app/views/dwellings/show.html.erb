<div class="row">
  <h1><%= @dwelling.nickname %></h1>
</div>

<div class="row">
  <div class="span6 pull-left"  
  <h3 class="address">
  <%= @dwelling.street_address %></br>
  <%= @dwelling.city %>, <%= @dwelling.state %> <%= @dwelling.zip %>
  </h3>
  </div>
  
  <div class="span6 pull-right">
  <h3>Currently living in this dwelling:</h3>
    
    <ul id="roomie_list">
     <% @dwelling.roomies.each do |u| %>
       <li><h4><%= link_to u.full_name, u %></h4></li>
    <% end %>
    </ul>
  </div>
</div>  
  
  <legend><%= @dwelling.bills.count %> Active Bills <small><%= "(#{@dwelling.bills.where(paid: false).count} unpaid)" %></small></legend>
  <small><%= link_to "+ add a new bill", new_bill_path %></small>
    <!-- BEGIN CODE FOR LIST OF BILLS NOT SORTED BY DUE DATE MONTH
    <div class="row">
    <% @dwelling.bills.each do |b| %>
        
        <div class="span3 well <% if b.paid %>paid-bill<% end %>">
          <b><%= link_to b.name, b %></b><% if b.paid %><b> (PAID)</b><% end %></br>
          <%= b.provider %></br>
          <b>Total due:</b> $<%= "%.2f" % b.total_due %></br>
          <b>Due in: </b>
          <% if Time.now > b.due_date %>
            <b>PAST DUE</b> (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% else %>
            <%= distance_of_time_in_words(Time.now, b.due_date) %>
             (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% end %>
          <% if b.user_id == current_user.id %>
            <% unless b.paid %>
              <%= button_to("Mark as paid", controller: "bills", action: "mark_as_paid", id: b.id) %>
            <% end %>
          <% end %>
          <% if b.user_id == current_user.id %>
            <small>This bill is managed by you.</small>
          <% else %>
            <small>This bill is managed by <%= b.user.first_name %></small>
          <% end %>
         
          
        </div>
        
    <% end %>
    </div> 
    END CODE FOR LIST OF BILLS NOT SORTED BY DUE DATE MONTH -->
    
    <% current_month = Time.now.strftime("%B") %> 
    <% next_month = (Time.new(Time.now.year, (Time.now.month + 1), Time.now.day)).strftime("%B") %>
    
    <legend><%= current_month %> Bills</legend>
    <div class="row">
    <% @dwelling.bills.each do |b| %>
      <% if b.due_date.strftime("%B") == current_month %>
        
        <div class="span3 well <% if b.paid %>paid-bill<% end %>">
          <b><%= link_to b.name, b %></b><% if b.paid %><b> (PAID)</b><% end %></br>
          <%= b.provider %></br>
          <b>Total due:</b> $<%= "%.2f" % b.total_due %></br>
          <b>Due in: </b>
          <% if Time.now > b.due_date %>
            <b>PAST DUE</b> (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% else %>
            <%= distance_of_time_in_words(Time.now, b.due_date) %>
             (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% end %>
          <% if b.user_id == current_user.id %>
            <% unless b.paid %>
              <%= button_to("Mark as paid", controller: "bills", action: "mark_as_paid", id: b.id) %>
            <% end %>
          <% end %>
          <% if b.user_id == current_user.id %>
            <small>This bill is managed by you.</small>
          <% else %>
            <small>This bill is managed by <%= b.user.first_name %></small>
          <% end %>
        </div>
      <% end %>
    <% end %>
    </div>
    
    <legend><%= next_month %> Bills</legend>
    <div class="row">
    <% @dwelling.bills.each do |b| %>
      <% if b.due_date.strftime("%B") == next_month %>
        
        <div class="span3 well <% if b.paid %>paid-bill<% end %>">
          <b><%= link_to b.name, b %></b><% if b.paid %><b> (PAID)</b><% end %></br>
          <%= b.provider %></br>
          <b>Total due:</b> $<%= "%.2f" % b.total_due %></br>
          <b>Due in: </b>
          <% if Time.now > b.due_date %>
            <b>PAST DUE</b> (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% else %>
            <%= distance_of_time_in_words(Time.now, b.due_date) %>
             (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% end %>
          <% if b.user_id == current_user.id %>
            <% unless b.paid %>
              <%= button_to("Mark as paid", controller: "bills", action: "mark_as_paid", id: b.id) %>
            <% end %>
          <% end %>
          <% if b.user_id == current_user.id %>
            <small>This bill is managed by you.</small>
          <% else %>
            <small>This bill is managed by <%= b.user.first_name %></small>
          <% end %>
        </div>
      <% end %>
    <% end %>
    </div>
    
    <legend>Bills Later This Year</legend>
    <div class="row">
      <% @dwelling.bills.each do |b| %>
        <% unless b.due_date.strftime("%B") == current_month || b.due_date.strftime("%B") == next_month %>
          <div class="span3 well <% if b.paid %>paid-bill<% end %>">
          <b><%= link_to b.name, b %></b><% if b.paid %><b> (PAID)</b><% end %></br>
          <%= b.provider %></br>
          <b>Total due:</b> $<%= "%.2f" % b.total_due %></br>
          <b>Due in: </b>
          <% if Time.now > b.due_date %>
            <b>PAST DUE</b> (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% else %>
            <%= distance_of_time_in_words(Time.now, b.due_date) %>
             (on <%= b.due_date.strftime("%m/%d/%Y") %>)</br>
          <% end %>
          <% if b.user_id == current_user.id %>
            <% unless b.paid %>
              <%= button_to("Mark as paid", controller: "bills", action: "mark_as_paid", id: b.id) %>
            <% end %>
          <% end %>
          <% if b.user_id == current_user.id %>
            <small>This bill is managed by you.</small>
          <% else %>
            <small>This bill is managed by <%= b.user.first_name %></small>
          <% end %>
        </div>
      <% end %>
    <% end %>
    </div>